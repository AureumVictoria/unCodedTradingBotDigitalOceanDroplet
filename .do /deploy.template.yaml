# .do/deploy.template.yaml
spec:
  name: trading-bot-app

  workers:
    - name: trading-bot
      instance_size_slug: apps-s-1vcpu-0.5gb
      instance_count: 1
      image:
        registry_type: DOCKER_HUB
        registry: aureumvictoria
        repository: uncoded-trading-bot
        tag: "2025.09.09"
      envs:
        # ---- ZUERST: App-ENVs ----
        - key: API_KEY
          scope: RUN_TIME
          type: SECRET
        - key: API_SECRET
          scope: RUN_TIME
          type: SECRET

        # ---- DB-ENVs (mit SSL-Erzwingung) ----
        - key: POSTGRES_HOST
          scope: RUN_TIME
          value: "${db.HOSTNAME}"
        - key: POSTGRES_PORT
          scope: RUN_TIME
          value: "${db.PORT}"
        - key: POSTGRES_DB
          scope: RUN_TIME
          value: "${db.DATABASE}"
        - key: POSTGRES_USER
          scope: RUN_TIME
          value: "${db.USERNAME}"
        - key: POSTGRES_PASSWORD
          scope: RUN_TIME
          value: "${db.PASSWORD}"
        - key: DATABASE_URL
          scope: RUN_TIME
          value: "${db.DATABASE_URL}"
        - key: PGSSLMODE
          scope: RUN_TIME
          value: "require"

    - name: telegram-bot
      instance_size_slug: apps-s-1vcpu-0.5gb
      instance_count: 1
      image:
        registry_type: DOCKER_HUB
        registry: aureumvictoria
        repository: uncoded-telegram-bot
        tag: "2025.09.09"
      envs:
        # ---- ZUERST: Telegram-ENVs ----
        - key: TELEGRAM_BOT_TOKEN
          scope: RUN_TIME
          type: SECRET
          value: "535695104:AAF43-oaqF9GVRkBW3UFnxESIbJXdVCZA58"
        - key: TELEGRAM_GROUP_ID
          scope: RUN_TIME
          value: "-1002896686710"
        - key: TELEGRAM_OWNER_ID
          scope: RUN_TIME
          value: "545568537"

        # ---- DB-ENVs (mit SSL-Erzwingung) ----
        - key: POSTGRES_HOST
          scope: RUN_TIME
          value: "${db.HOSTNAME}"
        - key: POSTGRES_PORT
          scope: RUN_TIME
          value: "${db.PORT}"
        - key: POSTGRES_DB
          scope: RUN_TIME
          value: "${db.DATABASE}"
        - key: POSTGRES_USER
          scope: RUN_TIME
          value: "${db.USERNAME}"
        - key: POSTGRES_PASSWORD
          scope: RUN_TIME
          value: "${db.PASSWORD}"
        - key: DATABASE_URL
          scope: RUN_TIME
          value: "${db.DATABASE_URL}"
        - key: PGSSLMODE
          scope: RUN_TIME
          value: "require"

  databases:
    - name: db
      engine: PG
      version: "16"
      production: false
